<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CLI: telnet.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_46f6ae84f50104985339032eb987b839.html">cpp</a>      </li>
      <li><a class="el" href="dir_8aeae964f4821b866509a437ddff25aa.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>telnet.cpp</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    Copyright (c) 2006-2010, Alexis Royer, http://alexis.royer.free.fr/CLI</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">    All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">    Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">        * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
<a name="l00009"></a>00009 <span class="comment">        * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
<a name="l00010"></a>00010 <span class="comment">        * Neither the name of the CLI library project nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00013"></a>00013 <span class="comment">    &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00014"></a>00014 <span class="comment">    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00015"></a>00015 <span class="comment">    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<a name="l00016"></a>00016 <span class="comment">    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<a name="l00017"></a>00017 <span class="comment">    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<a name="l00018"></a>00018 <span class="comment">    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<a name="l00019"></a>00019 <span class="comment">    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<a name="l00020"></a>00020 <span class="comment">    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<a name="l00021"></a>00021 <span class="comment">    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00022"></a>00022 <span class="comment">    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00023"></a>00023 <span class="comment">*/</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="pch_8h.html" title="CLI library default pre-compiled header.">cli/pch.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#ifndef CLI_WIN_NETWORK</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">    #include &lt;errno.h&gt;</span> <span class="comment">// errno</span>
<a name="l00030"></a>00030 <span class="preprocessor">    #define socket_errno errno</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">    #include &lt;sys/types.h&gt;</span> <span class="comment">// socket, bind, listen</span>
<a name="l00032"></a>00032 <span class="preprocessor">    #include &lt;sys/socket.h&gt;</span> <span class="comment">// socket, bind, listen</span>
<a name="l00033"></a>00033 <span class="preprocessor">    #include &lt;netinet/in.h&gt;</span> <span class="comment">// sockaddr_in</span>
<a name="l00034"></a>00034 <span class="preprocessor">    #include &lt;unistd.h&gt;</span> <span class="comment">// getpid</span>
<a name="l00035"></a>00035 <span class="preprocessor">#else</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">    #include &lt;winsock2.h&gt;</span> <span class="comment">// Windows sockets</span>
<a name="l00037"></a>00037 <span class="preprocessor">    #define socket_errno WSAGetLastError()</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">    #define socklen_t int</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">    #define EADDRINUSE WSAEADDRINUSE</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">    #define SHUT_RD SD_RECEIVE</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">    #define SHUT_WR SD_SEND</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">    #define SHUT_RDWR SD_BOTH</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">    #define close closesocket</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">    #define sleep(seconds) Sleep((seconds)*1000)</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>    <span class="comment">// Disable disturbing macros.</span>
<a name="l00046"></a>00046 <span class="preprocessor">    #undef DELETE</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span> <span class="comment">// close</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="telnet_8h.html" title="TelnetServer and TelnetConnection classes definition.">cli/telnet.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="shell_8h.html" title="Shell class definition.">cli/shell.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="traces_8h.html" title="Traces management system definition.">cli/traces.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <a class="code" href="namespace_8h.html#a965caf70ca576c007bee150001248651" title="Using namespace directive.">CLI_NS_USE</a>(cli)
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#ifndef CLI_TELNET_INPUT_BUFFER_SIZE</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">    #define CLI_TELNET_INPUT_BUFFER_SIZE 1024</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="preprocessor">#define CLI_TELNET_SERVER GetTelnetServerTraceClass()</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a>&amp; GetTelnetServerTraceClass(<span class="keywordtype">void</span>)
<a name="l00066"></a>00066 {
<a name="l00067"></a>00067     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a> cli_TelnetServerTraceClass(<span class="stringliteral">&quot;CLI_TELNET_SERVER&quot;</span>, <a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00068"></a>00068         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">&quot;CLI telnet server traces&quot;</span>)
<a name="l00069"></a>00069         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">&quot;Traces de serveur telnet CLI&quot;</span>));
<a name="l00070"></a>00070     <span class="keywordflow">return</span> cli_TelnetServerTraceClass;
<a name="l00071"></a>00071 }
<a name="l00073"></a>00073 <span class="preprocessor">#define CLI_TELNET_IN GetTelnetInTraceClass()</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a>00075 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a>&amp; GetTelnetInTraceClass(<span class="keywordtype">void</span>)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a> cli_TelnetInTraceClass(<span class="stringliteral">&quot;CLI_TELNET_IN&quot;</span>, <a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00078"></a>00078         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">&quot;CLI telnet connection input traces&quot;</span>)
<a name="l00079"></a>00079         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">&quot;Traces d&#39;entrées d&#39;une connexion telnet CLI&quot;</span>));
<a name="l00080"></a>00080     <span class="keywordflow">return</span> cli_TelnetInTraceClass;
<a name="l00081"></a>00081 }
<a name="l00083"></a>00083 <span class="preprocessor">#define CLI_TELNET_OUT GetTelnetOutTraceClass()</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span>
<a name="l00085"></a>00085 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a>&amp; GetTelnetOutTraceClass(<span class="keywordtype">void</span>)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087     <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classTraceClass.html" title="Trace class object.">TraceClass</a> cli_TelnetOutTraceClass(<span class="stringliteral">&quot;CLI_TELNET_OUT&quot;</span>, <a class="code" href="classHelp.html" title="Help container class.">Help</a>()
<a name="l00088"></a>00088         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">Help::LANG_EN</a>, <span class="stringliteral">&quot;CLI telnet connection output traces&quot;</span>)
<a name="l00089"></a>00089         .AddHelp(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">Help::LANG_FR</a>, <span class="stringliteral">&quot;Traces de sorties d&#39;une connexion telnet CLI&quot;</span>));
<a name="l00090"></a>00090     <span class="keywordflow">return</span> cli_TelnetOutTraceClass;
<a name="l00091"></a>00091 }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 TelnetServer::TelnetServer(<a class="code" href="classShell.html" title="Shell management.">Shell</a>&amp; CLI_Shell, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> UL_TcpPort)
<a name="l00095"></a>00095   : m_cliShell(CLI_Shell),
<a name="l00096"></a>00096     m_ulTcpPort(UL_TcpPort)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a6e460792b0696ff90a7d35f77a941c6d" title="Trace class declaration.">Declare</a>(CLI_TELNET_SERVER);
<a name="l00099"></a>00099     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a6e460792b0696ff90a7d35f77a941c6d" title="Trace class declaration.">Declare</a>(CLI_TELNET_IN);
<a name="l00100"></a>00100     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a6e460792b0696ff90a7d35f77a941c6d" title="Trace class declaration.">Declare</a>(CLI_TELNET_OUT);
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <a class="code" href="classTelnetServer.html#ace9f6cf047ae8a1e427ca7ca5dcbce12" title="Destructor.">TelnetServer::~TelnetServer</a>(<span class="keywordtype">void</span>)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keywordtype">void</span> <a class="code" href="classTelnetServer.html#a97520ee0f8761c9827cb13addc8ffd68" title="Starts the server.">TelnetServer::StartServer</a>(<span class="keywordtype">void</span>)
<a name="l00108"></a>00108 {
<a name="l00109"></a>00109     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;Starting server on port &quot;</span> &lt;&lt; m_ulTcpPort &lt;&lt; <a class="code" href="io__device_8h.html#ad6d7d55b8cc249130097ce4007a1162a">endl</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111     <span class="keyword">const</span> <span class="keywordtype">int</span> i_ServerSocket = socket(AF_INET, SOCK_STREAM, 0);
<a name="l00112"></a>00112 <span class="preprocessor">#ifdef CLI_WIN_NETWORK</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>    <span class="comment">// Winsock needs to be initialized.</span>
<a name="l00114"></a>00114     <span class="keywordflow">if</span> (i_ServerSocket &lt; 0)
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116         WORD wVersionRequested = MAKEWORD(2, 2);
<a name="l00117"></a>00117         WSADATA wsaData;
<a name="l00118"></a>00118         <span class="keywordtype">int</span> err = WSAStartup(wVersionRequested, &amp; wsaData);
<a name="l00119"></a>00119         <span class="keywordflow">if</span> (err == 0)
<a name="l00120"></a>00120         {
<a name="l00121"></a>00121             ((<span class="keywordtype">int</span>&amp;) i_ServerSocket) = socket(AF_INET, SOCK_STREAM, 0);
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 <span class="preprocessor">#endif</span>
<a name="l00125"></a>00125 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (i_ServerSocket &lt; 0)
<a name="l00126"></a>00126     {
<a name="l00127"></a>00127         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00128"></a>00128             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;socket() failed&quot;</span>)
<a name="l00129"></a>00129             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction socket()&quot;</span>);
<a name="l00130"></a>00130         <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00131"></a>00131         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00132"></a>00132         <span class="keywordflow">return</span>;
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;socket() successful (i_ServerSocket = &quot;</span> &lt;&lt; i_ServerSocket &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">// So that we can re-bind to it without TIME_WAIT problems</span>
<a name="l00137"></a>00137     <span class="keywordtype">int</span> i_ReuseAddr = 1;
<a name="l00138"></a>00138     <span class="keywordflow">if</span> (setsockopt(i_ServerSocket, SOL_SOCKET, SO_REUSEADDR, (<span class="keyword">const</span> <span class="keywordtype">char</span>*) &amp; i_ReuseAddr, <span class="keyword">sizeof</span>(i_ReuseAddr)) != 0)
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140         close(i_ServerSocket);
<a name="l00141"></a>00141         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00142"></a>00142             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;setsockopt() failed&quot;</span>)
<a name="l00143"></a>00143             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction setsockopt()&quot;</span>);
<a name="l00144"></a>00144         <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00145"></a>00145         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00146"></a>00146         <span class="keywordflow">return</span>;
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="comment">// Bind the socket</span>
<a name="l00150"></a>00150     <span class="keyword">struct </span>sockaddr_in s_SockAddr;
<a name="l00151"></a>00151     s_SockAddr.sin_family = AF_INET;
<a name="l00152"></a>00152     s_SockAddr.sin_port = htons((<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>) m_ulTcpPort);
<a name="l00153"></a>00153     s_SockAddr.sin_addr.s_addr = INADDR_ANY;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keywordtype">int</span> i_BindTries = 0;
<a name="l00156"></a>00156     <span class="keywordflow">while</span> (bind(i_ServerSocket, (<span class="keyword">struct</span> sockaddr*) &amp; s_SockAddr, <span class="keyword">sizeof</span>(s_SockAddr)) &lt; 0)
<a name="l00157"></a>00157     {
<a name="l00158"></a>00158         i_BindTries ++;
<a name="l00159"></a>00159         <span class="keywordflow">if</span> ((socket_errno == EADDRINUSE) &amp;&amp; (i_BindTries &lt; 2))
<a name="l00160"></a>00160         {
<a name="l00161"></a>00161             sleep(500);
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163         <span class="keywordflow">else</span>
<a name="l00164"></a>00164         {
<a name="l00165"></a>00165             close(i_ServerSocket);
<a name="l00166"></a>00166             <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00167"></a>00167                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;bind() failed&quot;</span>)
<a name="l00168"></a>00168                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction bind()&quot;</span>);
<a name="l00169"></a>00169             <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00170"></a>00170             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00171"></a>00171             <span class="keywordflow">return</span>;
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;bind() successful&quot;</span> &lt;&lt; endl;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">// Make the server listen up to 5 clients</span>
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (listen(i_ServerSocket, 5) &lt; 0)
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179         close(i_ServerSocket);
<a name="l00180"></a>00180         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00181"></a>00181             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;listen() failed&quot;</span>)
<a name="l00182"></a>00182             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction listen()&quot;</span>);
<a name="l00183"></a>00183         <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00184"></a>00184         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00185"></a>00185         <span class="keywordflow">return</span>;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;listen() successful&quot;</span> &lt;&lt; endl;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="keywordflow">while</span> (1)
<a name="l00190"></a>00190     {
<a name="l00191"></a>00191         <span class="comment">// Wait for a client</span>
<a name="l00192"></a>00192         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;Waiting for clients...&quot;</span> &lt;&lt; endl;
<a name="l00193"></a>00193         <span class="keyword">const</span> <span class="keywordtype">int</span> i_ConnectionSocket = accept(i_ServerSocket, NULL, NULL);
<a name="l00194"></a>00194         <span class="keywordflow">if</span> (i_ConnectionSocket &lt; 0)
<a name="l00195"></a>00195         {
<a name="l00196"></a>00196             close(i_ServerSocket);
<a name="l00197"></a>00197             <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00198"></a>00198                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;accept() failed&quot;</span>)
<a name="l00199"></a>00199                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction accept()&quot;</span>);
<a name="l00200"></a>00200             <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00201"></a>00201             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00202"></a>00202             <span class="keywordflow">return</span>;
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;accept() successful (i_ConnectionSocket = &quot;</span> &lt;&lt; i_ConnectionSocket &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="comment">// Accept the client</span>
<a name="l00207"></a>00207         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_InfoClient = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00208"></a>00208             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;Accepting telnet connection&quot;</span>)
<a name="l00209"></a>00209             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Connexion telnet acceptée&quot;</span>);
<a name="l00210"></a>00210         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; cli_InfoClient.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00211"></a>00211         <span class="keywordflow">if</span> (! AcceptConnection(i_ConnectionSocket))
<a name="l00212"></a>00212         {
<a name="l00213"></a>00213             <span class="keywordflow">return</span>;
<a name="l00214"></a>00214         }
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="comment">// Release server resources</span>
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (close(i_ServerSocket) != 0)
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220         close(i_ServerSocket);
<a name="l00221"></a>00221         <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00222"></a>00222             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;close() failed&quot;</span>)
<a name="l00223"></a>00223             .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction close()&quot;</span>);
<a name="l00224"></a>00224         <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00225"></a>00225         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00226"></a>00226         <span class="keywordflow">return</span>;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;close(&quot;</span> &lt;&lt; i_ServerSocket &lt;&lt; <span class="stringliteral">&quot;) successful&quot;</span> &lt;&lt; endl;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;Server is done.&quot;</span> &lt;&lt; endl;
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="keyword">const</span> <span class="keywordtype">bool</span> TelnetServer::AcceptConnection(<span class="keyword">const</span> <span class="keywordtype">int</span> I_ConnectionSocket)
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235     <span class="keywordtype">int</span> i_Pid = 0;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="preprocessor">#ifdef CLI_TELNET_MULTI_CLIENT</span>
<a name="l00238"></a>00238 <span class="preprocessor"></span><span class="preprocessor">    #ifndef CLI_WIN_NETWORK</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (i_Pid = fork())
<a name="l00240"></a>00240 <span class="preprocessor">    #else</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span><span class="preprocessor">#error CLI_TELNET_MULTI_CLIENT / CLI_WIN_NETWORK incompatibility. Do not use CLI_TELNET_MULTI_CLIENT when compiling for non POSIX operating systems.</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>    {
<a name="l00244"></a>00244         <span class="comment">// Server side.</span>
<a name="l00245"></a>00245         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247     <span class="keywordflow">else</span>
<a name="l00248"></a>00248 <span class="preprocessor">#endif</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>    {
<a name="l00250"></a>00250         <span class="comment">// Connection side.</span>
<a name="l00251"></a>00251 <span class="preprocessor">#ifndef CLI_WIN_NETWORK</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>        i_Pid = getpid();
<a name="l00253"></a>00253 <span class="preprocessor">#else</span>
<a name="l00254"></a>00254 <span class="preprocessor"></span>        i_Pid = GetCurrentThreadId();
<a name="l00255"></a>00255 <span class="preprocessor">#endif</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>        <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;Execution started (pid = &quot;</span> &lt;&lt; i_Pid &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <span class="comment">// Configure LINGER option</span>
<a name="l00259"></a>00259         linger t_Linger;
<a name="l00260"></a>00260         t_Linger.l_onoff = 1; <span class="comment">// enable LINGER</span>
<a name="l00261"></a>00261         t_Linger.l_linger = 1; <span class="comment">// seconds</span>
<a name="l00262"></a>00262         <span class="keywordflow">if</span> (setsockopt(I_ConnectionSocket, SOL_SOCKET, SO_LINGER, (<span class="keyword">const</span> <span class="keywordtype">char</span>*) &amp; t_Linger, <span class="keyword">sizeof</span>(t_Linger)) != 0)
<a name="l00263"></a>00263         {
<a name="l00264"></a>00264             close(I_ConnectionSocket);
<a name="l00265"></a>00265             <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00266"></a>00266                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;setsockopt(SO_LINGER) failed&quot;</span>)
<a name="l00267"></a>00267                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction setsockopt(SO_LINGER)&quot;</span>);
<a name="l00268"></a>00268             <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00269"></a>00269             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00270"></a>00270             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;setsockopt(&quot;</span> &lt;&lt; I_ConnectionSocket &lt;&lt; <span class="stringliteral">&quot;, SO_LINGER) successful&quot;</span> &lt;&lt; endl;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="keywordflow">if</span> (<a class="code" href="classTelnetConnection.html" title="Telnet connection input/output device.">TelnetConnection</a>* <span class="keyword">const</span> pcli_Connection = <span class="keyword">new</span> <a class="code" href="classTelnetConnection.html" title="Telnet connection input/output device.">TelnetConnection</a>(m_cliShell, I_ConnectionSocket, <span class="keyword">true</span>))
<a name="l00275"></a>00275         {
<a name="l00276"></a>00276             pcli_Connection-&gt;<a class="code" href="classOutputDevice.html#a5cf7d389260e7c6a349efb9c2f5da262" title="Ensures instance validity.">UseInstance</a>(<a class="code" href="debug_8h.html#a12506d620d4ecd0161866c9b19d761ed" title="Call information filling.">__CALL_INFO__</a>);
<a name="l00277"></a>00277             m_cliShell.<a class="code" href="classShell.html#a678c17eba603acfa45838a710b50a76c" title="Runs the shell onto the corresponding input/output device.">Run</a>(*pcli_Connection);
<a name="l00278"></a>00278             pcli_Connection-&gt;FreeInstance(<a class="code" href="debug_8h.html#a12506d620d4ecd0161866c9b19d761ed" title="Call information filling.">__CALL_INFO__</a>);
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;Execution done (pid = &quot;</span> &lt;&lt; i_Pid &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="preprocessor">#ifdef CLI_TELNET_MULTI_CLIENT</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span>        exit(0);
<a name="l00284"></a>00284 <span class="preprocessor">#else</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>        <span class="comment">// Did not manage to correctly end up the connection on the server side,</span>
<a name="l00286"></a>00286         <span class="comment">// neither on Windows nor Linux systems.</span>
<a name="l00287"></a>00287         <span class="comment">// This a hack until I provide another implementation.</span>
<a name="l00288"></a>00288         {
<a name="l00289"></a>00289             linger t_Linger; socklen_t i_Len = <span class="keyword">sizeof</span>(t_Linger);
<a name="l00290"></a>00290             <span class="keywordflow">if</span> (getsockopt(I_ConnectionSocket, SOL_SOCKET, SO_LINGER, (<span class="keywordtype">char</span>*) &amp; t_Linger, &amp; i_Len) != 0)
<a name="l00291"></a>00291             {
<a name="l00292"></a>00292                 close(I_ConnectionSocket);
<a name="l00293"></a>00293                 <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00294"></a>00294                     .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;getsockopt(SO_LINGER) failed&quot;</span>)
<a name="l00295"></a>00295                     .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction getsockopt(SO_LINGER)&quot;</span>);
<a name="l00296"></a>00296                 <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00297"></a>00297                 <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00298"></a>00298                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00299"></a>00299             }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301             <span class="keywordflow">if</span> (t_Linger.l_onoff)
<a name="l00302"></a>00302             {
<a name="l00303"></a>00303                 sleep(t_Linger.l_linger);
<a name="l00304"></a>00304             }
<a name="l00305"></a>00305         }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="comment">// Stop sending characters</span>
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (shutdown(I_ConnectionSocket, SHUT_WR) != 0)
<a name="l00309"></a>00309         {
<a name="l00310"></a>00310             close(I_ConnectionSocket);
<a name="l00311"></a>00311             <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00312"></a>00312                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;shutdown() failed&quot;</span>)
<a name="l00313"></a>00313                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction shutdown()&quot;</span>);
<a name="l00314"></a>00314             <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00315"></a>00315             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00316"></a>00316             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;shutdown(&quot;</span> &lt;&lt; I_ConnectionSocket &lt;&lt; <span class="stringliteral">&quot;) successful&quot;</span> &lt;&lt; endl;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="comment">// Release resources</span>
<a name="l00321"></a>00321         <span class="keywordflow">if</span> (close(I_ConnectionSocket) != 0)
<a name="l00322"></a>00322         {
<a name="l00323"></a>00323             close(I_ConnectionSocket);
<a name="l00324"></a>00324             <span class="keyword">const</span> <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a> cli_Error = <a class="code" href="classResourceString.html" title="ResourceString class.">ResourceString</a>()
<a name="l00325"></a>00325                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;close() failed&quot;</span>)
<a name="l00326"></a>00326                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de la fonction close()&quot;</span>);
<a name="l00327"></a>00327             <a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">OutputDevice::GetStdErr</a>() &lt;&lt; cli_Error.<a class="code" href="classResourceString.html#a4d3d3e8d79d9dfb2c010564afc3b374f" title="Access to the string of a given language.">GetString</a>(m_cliShell.<a class="code" href="classShell.html#afae8f69c25a41e89d184e3c49b1b3918" title="Language access.">GetLang</a>()) &lt;&lt; endl;
<a name="l00328"></a>00328             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00329"></a>00329             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;close(&quot;</span> &lt;&lt; I_ConnectionSocket &lt;&lt; <span class="stringliteral">&quot;) successful&quot;</span> &lt;&lt; endl;
<a name="l00332"></a>00332 <span class="preprocessor">#endif</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span>
<a name="l00334"></a>00334         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 TelnetConnection::TelnetConnection(
<a name="l00340"></a>00340         <a class="code" href="classShell.html" title="Shell management.">Shell</a>&amp; CLI_Shell,
<a name="l00341"></a>00341         <span class="keyword">const</span> <span class="keywordtype">int</span> I_ConnectionSocket,
<a name="l00342"></a>00342         <span class="keyword">const</span> <span class="keywordtype">bool</span> B_AutoDelete)
<a name="l00343"></a>00343   : <a class="code" href="classIODevice.html" title="Generic input/output device.">IODevice</a>(<span class="stringliteral">&quot;telnet&quot;</span>, B_AutoDelete),
<a name="l00344"></a>00344     m_iSocket(I_ConnectionSocket),
<a name="l00345"></a>00345     m_qChars(<a class="code" href="preprocessing_8h.html#ac9caea23061b23d302f307a82a8ae779" title="Size of telnet input buffer.">CLI_TELNET_INPUT_BUFFER_SIZE</a>)
<a name="l00346"></a>00346 {
<a name="l00347"></a>00347 }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349 <a class="code" href="classTelnetConnection.html#a8689fb73dc61bbb43d8c72521d9a7d81" title="Destructor.">TelnetConnection::~TelnetConnection</a>(<span class="keywordtype">void</span>)
<a name="l00350"></a>00350 {
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classTelnetConnection.html#ae87d5ea164dbdabb856c34db2b621a7c" title="Open device handler.">TelnetConnection::OpenDevice</a>(<span class="keywordtype">void</span>)
<a name="l00354"></a>00354 {
<a name="l00355"></a>00355     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="classTelnetConnection.html#ac7acd3e206a292f35f55c1b5d4597f7c" title="Close device handler.">TelnetConnection::CloseDevice</a>(<span class="keywordtype">void</span>)
<a name="l00359"></a>00359 {
<a name="l00360"></a>00360 <span class="preprocessor">#ifdef CLI_TELNET_MULTI_CLIENT</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span>    close(m_iSocket);
<a name="l00362"></a>00362 <span class="preprocessor">#endif</span>
<a name="l00363"></a>00363 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 <span class="keyword">const</span> <a class="code" href="io__device_8h.html#a90d295cf6b6bc9873c186cc8851147f8" title="Input characters.">KEY</a> <a class="code" href="classTelnetConnection.html#ae3858fcf54afc30be3a18370b0623eac" title="Character input handler.">TelnetConnection::GetKey</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00367"></a>00367 <span class="keyword"></span>{
<a name="l00368"></a>00368     <span class="comment">// Wait for characters if needed</span>
<a name="l00369"></a>00369     <span class="keywordtype">bool</span> b_ReceiveCharacters = <span class="keyword">false</span>;
<a name="l00370"></a>00370     <span class="keywordflow">if</span> (m_qChars.IsEmpty())
<a name="l00371"></a>00371     {
<a name="l00372"></a>00372         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;m_qChars.GetCount() = &quot;</span> &lt;&lt; m_qChars.GetCount() &lt;&lt; endl;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374         b_ReceiveCharacters = <span class="keyword">true</span>;
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_qChars.GetCount() &lt; 10)
<a name="l00377"></a>00377     {
<a name="l00378"></a>00378         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;m_qChars.GetCount() = &quot;</span> &lt;&lt; m_qChars.GetCount() &lt;&lt; endl;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="comment">// Just peek the socket to read if there are characters remaining</span>
<a name="l00381"></a>00381         fd_set fd_read; FD_ZERO(&amp; fd_read); FD_SET(m_iSocket, &amp; fd_read);
<a name="l00382"></a>00382         timeval t_Timeout; t_Timeout.tv_sec = 0; t_Timeout.tv_usec = 10000;
<a name="l00383"></a>00383         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Select = select(FD_SETSIZE, &amp; fd_read, NULL, NULL, &amp; t_Timeout);
<a name="l00384"></a>00384         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;select() returned &quot;</span> &lt;&lt; i_Select &lt;&lt; endl;
<a name="l00385"></a>00385         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;FD_ISSET(m_iSocket, &amp; fd_read) = &quot;</span> &lt;&lt; FD_ISSET(m_iSocket, &amp; fd_read) &lt;&lt; endl;
<a name="l00386"></a>00386         <span class="keywordflow">if</span> ((i_Select &gt; 0) &amp;&amp; FD_ISSET(m_iSocket, &amp; fd_read))
<a name="l00387"></a>00387         {
<a name="l00388"></a>00388             b_ReceiveCharacters = <span class="keyword">true</span>;
<a name="l00389"></a>00389         }
<a name="l00390"></a>00390         <span class="keywordflow">if</span> (i_Select &lt; 0)
<a name="l00391"></a>00391         {
<a name="l00392"></a>00392             <a class="code" href="classOutputDevice.html#ac831dff60351f1a3dffd667e175e8f23" title="Last error.">m_cliLastError</a>
<a name="l00393"></a>00393                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;Telnet reception error&quot;</span>)
<a name="l00394"></a>00394                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de réception en telnet&quot;</span>);
<a name="l00395"></a>00395             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;select() failed, errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00396"></a>00396             <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ae42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>;
<a name="l00397"></a>00397         }
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (b_ReceiveCharacters)
<a name="l00400"></a>00400     {
<a name="l00401"></a>00401         <span class="comment">// Dequeue characters from the socket</span>
<a name="l00402"></a>00402         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;calling recv()...&quot;</span> &lt;&lt; endl;
<a name="l00403"></a>00403         <span class="keywordtype">char</span> str_Buffer[256];
<a name="l00404"></a>00404         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Len = recv(m_iSocket, str_Buffer, <span class="keyword">sizeof</span>(str_Buffer), 0);
<a name="l00405"></a>00405         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;recv() returned &quot;</span> &lt;&lt; i_Len &lt;&lt; endl;
<a name="l00406"></a>00406         <span class="keywordflow">if</span> (i_Len &lt;= 0)
<a name="l00407"></a>00407         {
<a name="l00408"></a>00408             <a class="code" href="classOutputDevice.html#ac831dff60351f1a3dffd667e175e8f23" title="Last error.">m_cliLastError</a>
<a name="l00409"></a>00409                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;Telnet reception error&quot;</span>)
<a name="l00410"></a>00410                 .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec de réception en telnet&quot;</span>);
<a name="l00411"></a>00411             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_SERVER) &lt;&lt; <span class="stringliteral">&quot;recv() failed, errno = &quot;</span> &lt;&lt; socket_errno &lt;&lt; endl;
<a name="l00412"></a>00412             <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ae42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>;
<a name="l00413"></a>00413         }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415         <span class="comment">// Queue them in the internal fifo</span>
<a name="l00416"></a>00416         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;i_Len; i++)
<a name="l00417"></a>00417         {
<a name="l00418"></a>00418             <span class="keywordflow">if</span> (str_Buffer[i] != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00419"></a>00419             {
<a name="l00420"></a>00420                 <span class="keywordflow">if</span> (! m_qChars.AddTail(str_Buffer[i]))
<a name="l00421"></a>00421                 {
<a name="l00422"></a>00422                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#a243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00423"></a>00423                         &lt;&lt; <span class="stringliteral">&quot;TelnetConnection::GetKey(): &quot;</span>
<a name="l00424"></a>00424                         &lt;&lt; <span class="stringliteral">&quot;Could not append character &#39;&quot;</span> &lt;&lt; str_Buffer[i] &lt;&lt; <span class="stringliteral">&quot;&#39; &quot;</span>
<a name="l00425"></a>00425                         &lt;&lt; <span class="stringliteral">&quot;to m_qChars&quot;</span> &lt;&lt; endl;
<a name="l00426"></a>00426                 }
<a name="l00427"></a>00427             }
<a name="l00428"></a>00428         }
<a name="l00429"></a>00429     }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431     <span class="comment">// Process characters</span>
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00433"></a>00433     {
<a name="l00434"></a>00434         <span class="comment">// Dequeue the received characters</span>
<a name="l00435"></a>00435         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Front = m_qChars.RemoveHead();
<a name="l00436"></a>00436         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;i_Char = &quot;</span> &lt;&lt; (char) i_Front &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; i_Front &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <span class="comment">// Special character management.</span>
<a name="l00439"></a>00439         <span class="keywordflow">switch</span> (i_Front)
<a name="l00440"></a>00440         {
<a name="l00441"></a>00441         <span class="keywordflow">case</span> 1:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471aeed3bac3a74a2eaf9a84d1a9774b67c1" title="Begin key.">KEY_BEGIN</a>;   <span class="comment">// CTRL+A</span>
<a name="l00442"></a>00442         <span class="keywordflow">case</span> 3:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a9524d094809858b9e4f778763913568a" title="Break (Ctrl+C).">BREAK</a>;       <span class="comment">// CTRL+C</span>
<a name="l00443"></a>00443         <span class="keywordflow">case</span> 4:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a86d6ca369e69a3a0f0c9bd063dd39a70" title="Logout (Ctrl+D).">LOGOUT</a>;      <span class="comment">// CTRL+D</span>
<a name="l00444"></a>00444         <span class="keywordflow">case</span> 5:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471aa8adb6fcb92dec58fb19410eacfdd403" title="End key.">KEY_END</a>;     <span class="comment">// CTRL+E</span>
<a name="l00445"></a>00445         <span class="keywordflow">case</span> 8:     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ad2534cebcf6f430484b7c931dd657ddc" title="Backspace.">BACKSPACE</a>;   <span class="comment">// CTRL+H</span>
<a name="l00446"></a>00446         <span class="keywordflow">case</span> 13:
<a name="l00447"></a>00447             <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00448"></a>00448             {
<a name="l00449"></a>00449                 <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;i_Char2 = &quot;</span> &lt;&lt; (char) m_qChars.GetHead() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; m_qChars.GetHead() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00450"></a>00450                 <span class="keywordflow">if</span> (m_qChars.GetHead() == 10)
<a name="l00451"></a>00451                 {
<a name="l00452"></a>00452                     <span class="comment">// Process only the character 13 when the sequence is 13-10.</span>
<a name="l00453"></a>00453                     m_qChars.RemoveHead();
<a name="l00454"></a>00454                     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a951ab68bb8f7daafb78951107080904e" title="Enter.">ENTER</a>;
<a name="l00455"></a>00455                 }
<a name="l00456"></a>00456             }
<a name="l00457"></a>00457             <span class="keywordflow">break</span>;
<a name="l00458"></a>00458         <span class="keywordflow">case</span> 12:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471aa5e0d06ffc1b0ee32eda539e6528a3e6" title="Clean screen key.">CLS</a>;         <span class="comment">// CTRL+L</span>
<a name="l00459"></a>00459         <span class="keywordflow">case</span> 14:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ab13b96bf99a409e019f70dc1602532fd" title="Forward key.">NEXT</a>;        <span class="comment">// CTRL+N</span>
<a name="l00460"></a>00460         <span class="keywordflow">case</span> 16:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ad9600a436d5cc272dfd53f6c45fdeca4" title="Previous key.">PREVIOUS</a>;    <span class="comment">// CTRL+P</span>
<a name="l00461"></a>00461         <span class="keywordflow">case</span> 25:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ad20f1b79e9cfc073db19741638050449" title="Redo.">REDO</a>;        <span class="comment">// CTRL+Y</span>
<a name="l00462"></a>00462         <span class="keywordflow">case</span> 26:    <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a22a937c23ef109ac28176b98dacad9c6" title="Undo.">UNDO</a>;        <span class="comment">// CTRL+Z</span>
<a name="l00463"></a>00463         <span class="keywordflow">case</span> 27:
<a name="l00464"></a>00464             <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00465"></a>00465             {
<a name="l00466"></a>00466                 <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;i_Char2 = &quot;</span> &lt;&lt; (char) m_qChars.GetHead() &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; m_qChars.GetHead() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00467"></a>00467                 <span class="keywordflow">if</span> (m_qChars.GetHead() == 91)
<a name="l00468"></a>00468                 {
<a name="l00469"></a>00469                     m_qChars.RemoveHead();
<a name="l00470"></a>00470 
<a name="l00471"></a>00471                     <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00472"></a>00472                     {
<a name="l00473"></a>00473                         <span class="keyword">const</span> <span class="keywordtype">int</span> i_Special = m_qChars.RemoveHead();
<a name="l00474"></a>00474                         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;i_Char3 = &quot;</span> &lt;&lt; (char) i_Special &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; i_Special &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476                         <span class="keywordflow">switch</span> (i_Special)
<a name="l00477"></a>00477                         {
<a name="l00478"></a>00478                         <span class="comment">// All characters that will be followed by a 126 character.</span>
<a name="l00479"></a>00479                         <span class="keywordflow">case</span> 49: <span class="comment">// INSERT</span>
<a name="l00480"></a>00480                         <span class="keywordflow">case</span> 50: <span class="comment">// KEY_BEGIN;</span>
<a name="l00481"></a>00481                         <span class="keywordflow">case</span> 51: <span class="comment">// PAGE_UP;</span>
<a name="l00482"></a>00482                         <span class="keywordflow">case</span> 52: <span class="comment">// DELETE;</span>
<a name="l00483"></a>00483                         <span class="keywordflow">case</span> 53: <span class="comment">// KEY_END;</span>
<a name="l00484"></a>00484                         <span class="keywordflow">case</span> 54: <span class="comment">// PAGE_DOWN;</span>
<a name="l00485"></a>00485                             <span class="keywordflow">if</span> (! m_qChars.IsEmpty())
<a name="l00486"></a>00486                             {
<a name="l00487"></a>00487                                 <span class="keyword">const</span> <span class="keywordtype">int</span> i_Finish = m_qChars.RemoveHead();
<a name="l00488"></a>00488                                 <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;i_Char4 = &quot;</span> &lt;&lt; (char) i_Finish &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; i_Finish &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490                                 <span class="keywordflow">if</span> (i_Finish == 126)
<a name="l00491"></a>00491                                 {
<a name="l00492"></a>00492                                     <span class="keywordflow">switch</span> (i_Special)
<a name="l00493"></a>00493                                     {
<a name="l00494"></a>00494                                     <span class="keywordflow">case</span> 49: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471aa15c451953b2d2a93403afe786930d0f" title="Insert key.">INSERT</a>;
<a name="l00495"></a>00495                                     <span class="keywordflow">case</span> 50: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471aeed3bac3a74a2eaf9a84d1a9774b67c1" title="Begin key.">KEY_BEGIN</a>;
<a name="l00496"></a>00496                                     <span class="keywordflow">case</span> 51: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a0442824c041b9618cd7c512205e7e6dc" title="Page up arrow key.">PAGE_UP</a>;
<a name="l00497"></a>00497                                     <span class="keywordflow">case</span> 52: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a9d61e82a9a12752f10aece1b22183913" title="Delete key.">DELETE</a>;
<a name="l00498"></a>00498                                     <span class="keywordflow">case</span> 53: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471aa8adb6fcb92dec58fb19410eacfdd403" title="End key.">KEY_END</a>;
<a name="l00499"></a>00499                                     <span class="keywordflow">case</span> 54: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a714c5d27586a8bcbab274d9176da1539" title="Page down arrow key.">PAGE_DOWN</a>;
<a name="l00500"></a>00500                                     }
<a name="l00501"></a>00501                                 }
<a name="l00502"></a>00502                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_Special == 49) &amp;&amp; (! m_qChars.IsEmpty()))
<a name="l00503"></a>00503                                 {
<a name="l00504"></a>00504                                     <span class="comment">// Function keys.</span>
<a name="l00505"></a>00505                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_Function = i_Finish;
<a name="l00506"></a>00506                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_FunctionFinish = m_qChars.RemoveHead();
<a name="l00507"></a>00507                                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;i_Char5 = &quot;</span> &lt;&lt; (char) i_FunctionFinish &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; i_FunctionFinish &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509                                     <span class="keywordflow">if</span> (i_FunctionFinish == 126)
<a name="l00510"></a>00510                                     {
<a name="l00511"></a>00511                                         <span class="keywordflow">switch</span> (i_Function)
<a name="l00512"></a>00512                                         {
<a name="l00513"></a>00513                                         <span class="keywordflow">case</span> 49: <span class="keywordflow">return</span> F1;
<a name="l00514"></a>00514                                         <span class="keywordflow">case</span> 50: <span class="keywordflow">return</span> F2;
<a name="l00515"></a>00515                                         <span class="keywordflow">case</span> 51: <span class="keywordflow">return</span> F3;
<a name="l00516"></a>00516                                         <span class="keywordflow">case</span> 52: <span class="keywordflow">return</span> F4;
<a name="l00517"></a>00517                                         <span class="keywordflow">case</span> 53: <span class="keywordflow">return</span> F5;
<a name="l00518"></a>00518                                         <span class="keywordflow">case</span> 55: <span class="keywordflow">return</span> F6;
<a name="l00519"></a>00519                                         <span class="keywordflow">case</span> 56: <span class="keywordflow">return</span> F7;
<a name="l00520"></a>00520                                         <span class="keywordflow">case</span> 57: <span class="keywordflow">return</span> F8;
<a name="l00521"></a>00521                                         }
<a name="l00522"></a>00522                                     }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524                                     <span class="comment">// Unhandled.</span>
<a name="l00525"></a>00525                                     <span class="keywordflow">if</span> (! m_qChars.AddHead(i_FunctionFinish))
<a name="l00526"></a>00526                                     {
<a name="l00527"></a>00527                                         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#a243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00528"></a>00528                                             &lt;&lt; <span class="stringliteral">&quot;TelnetConnection::GetKey(): &quot;</span>
<a name="l00529"></a>00529                                             &lt;&lt; <span class="stringliteral">&quot;Unable to restore previously removed character from m_qChars&quot;</span>
<a name="l00530"></a>00530                                             &lt;&lt; endl;
<a name="l00531"></a>00531                                     }
<a name="l00532"></a>00532                                 }
<a name="l00533"></a>00533                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i_Special == 50) &amp;&amp; (! m_qChars.IsEmpty()))
<a name="l00534"></a>00534                                 {
<a name="l00535"></a>00535                                     <span class="comment">// Function keys.</span>
<a name="l00536"></a>00536                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_Function = i_Finish;
<a name="l00537"></a>00537                                     <span class="keyword">const</span> <span class="keywordtype">int</span> i_FunctionFinish = m_qChars.RemoveHead();
<a name="l00538"></a>00538                                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_IN) &lt;&lt; <span class="stringliteral">&quot;i_Char5 = &quot;</span> &lt;&lt; (char) i_FunctionFinish &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; i_FunctionFinish &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540                                     <span class="keywordflow">if</span> (i_FunctionFinish == 126)
<a name="l00541"></a>00541                                     {
<a name="l00542"></a>00542                                         <span class="keywordflow">switch</span> (i_Function)
<a name="l00543"></a>00543                                         {
<a name="l00544"></a>00544                                         <span class="keywordflow">case</span> 48: <span class="keywordflow">return</span> F9;
<a name="l00545"></a>00545                                         <span class="keywordflow">case</span> 49: <span class="keywordflow">return</span> F10;
<a name="l00546"></a>00546                                         <span class="keywordflow">case</span> 51: <span class="keywordflow">return</span> F11;
<a name="l00547"></a>00547                                         <span class="keywordflow">case</span> 52: <span class="keywordflow">return</span> F12;
<a name="l00548"></a>00548                                         }
<a name="l00549"></a>00549                                     }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551                                     <span class="comment">// Unhandled.</span>
<a name="l00552"></a>00552                                     <span class="keywordflow">if</span> (! m_qChars.AddHead(i_FunctionFinish))
<a name="l00553"></a>00553                                     {
<a name="l00554"></a>00554                                         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#a243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00555"></a>00555                                             &lt;&lt; <span class="stringliteral">&quot;TelnetConnection::GetKey(): &quot;</span>
<a name="l00556"></a>00556                                             &lt;&lt; <span class="stringliteral">&quot;Unable to restore previously removed character from m_qChars&quot;</span>
<a name="l00557"></a>00557                                             &lt;&lt; endl;
<a name="l00558"></a>00558                                     }
<a name="l00559"></a>00559                                 }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561                                 <span class="comment">// Unhandled.</span>
<a name="l00562"></a>00562                                 <span class="keywordflow">if</span> (! m_qChars.AddHead(i_Finish))
<a name="l00563"></a>00563                                 {
<a name="l00564"></a>00564                                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#a243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00565"></a>00565                                         &lt;&lt; <span class="stringliteral">&quot;TelnetConnection::GetKey(): &quot;</span>
<a name="l00566"></a>00566                                         &lt;&lt; <span class="stringliteral">&quot;Unable to restore previously removed character from m_qChars&quot;</span>
<a name="l00567"></a>00567                                         &lt;&lt; endl;
<a name="l00568"></a>00568                                 }
<a name="l00569"></a>00569                             }
<a name="l00570"></a>00570                         <span class="keywordflow">case</span> 65: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a0848a442d907968b211b97bc2bd88acd" title="Up arrow key.">KEY_UP</a>;
<a name="l00571"></a>00571                         <span class="keywordflow">case</span> 66: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471aa9cdac7967bf7d88fdb761138a2a3416" title="Down arrow key.">KEY_DOWN</a>;
<a name="l00572"></a>00572                         <span class="keywordflow">case</span> 67: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a6504370d9c6391e1a9da6a1a529b089d" title="Right arrow key.">KEY_RIGHT</a>;
<a name="l00573"></a>00573                         <span class="keywordflow">case</span> 68: <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a612120b69c7dfd46086db7aaebdbcf65" title="Left arrow key.">KEY_LEFT</a>;
<a name="l00574"></a>00574                         }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576                         <span class="comment">// Unhandled.</span>
<a name="l00577"></a>00577                         <span class="keywordflow">if</span> (! m_qChars.AddHead(i_Special))
<a name="l00578"></a>00578                         {
<a name="l00579"></a>00579                             <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#a243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00580"></a>00580                                 &lt;&lt; <span class="stringliteral">&quot;TelnetConnection::GetKey(): &quot;</span>
<a name="l00581"></a>00581                                 &lt;&lt; <span class="stringliteral">&quot;Unable to restore previously removed character from m_qChars&quot;</span>
<a name="l00582"></a>00582                                 &lt;&lt; endl;
<a name="l00583"></a>00583                         }
<a name="l00584"></a>00584                     }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586                     <span class="comment">// Unhandled.</span>
<a name="l00587"></a>00587                     <span class="keywordflow">if</span> (! m_qChars.AddHead(91))
<a name="l00588"></a>00588                     {
<a name="l00589"></a>00589                         <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(<a class="code" href="traces_8h.html#a243b1b1f8ca7e7e98ac73a2d115256f4" title="Internal error common trace class singleton redirection.">INTERNAL_ERROR</a>)
<a name="l00590"></a>00590                             &lt;&lt; <span class="stringliteral">&quot;TelnetConnection::GetKey(): &quot;</span>
<a name="l00591"></a>00591                             &lt;&lt; <span class="stringliteral">&quot;Unable to restore previously removed character from m_qChars&quot;</span>
<a name="l00592"></a>00592                             &lt;&lt; endl;
<a name="l00593"></a>00593                     }
<a name="l00594"></a>00594                 }
<a name="l00595"></a>00595             }
<a name="l00596"></a>00596             <span class="keywordflow">else</span>
<a name="l00597"></a>00597             {
<a name="l00598"></a>00598                 <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a0a311695a4f6c56869245418bebeb33d" title="Escape.">ESCAPE</a>;
<a name="l00599"></a>00599             }
<a name="l00600"></a>00600             <span class="keywordflow">break</span>;
<a name="l00601"></a>00601         <span class="keywordflow">case</span> 96:    <span class="keywordflow">return</span> BACK_QUOTE;
<a name="l00602"></a>00602         <span class="keywordflow">case</span> 126:   <span class="keywordflow">return</span> TILDE;
<a name="l00603"></a>00603         <span class="keywordflow">case</span> 127:   <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471a9d61e82a9a12752f10aece1b22183913" title="Delete key.">DELETE</a>;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605         <span class="comment">// Accentuated characters.</span>
<a name="l00606"></a>00606         <span class="keywordflow">case</span> -31:   <span class="keywordflow">return</span> KEY_aacute;
<a name="l00607"></a>00607         <span class="keywordflow">case</span> -32:   <span class="keywordflow">return</span> KEY_agrave;
<a name="l00608"></a>00608         <span class="keywordflow">case</span> -28:   <span class="keywordflow">return</span> KEY_auml;
<a name="l00609"></a>00609         <span class="keywordflow">case</span> -30:   <span class="keywordflow">return</span> KEY_acirc;
<a name="l00610"></a>00610         <span class="keywordflow">case</span> -25:   <span class="keywordflow">return</span> KEY_ccedil;
<a name="l00611"></a>00611         <span class="keywordflow">case</span> -23:   <span class="keywordflow">return</span> KEY_eacute;
<a name="l00612"></a>00612         <span class="keywordflow">case</span> -24:   <span class="keywordflow">return</span> KEY_egrave;
<a name="l00613"></a>00613         <span class="keywordflow">case</span> -21:   <span class="keywordflow">return</span> KEY_euml;
<a name="l00614"></a>00614         <span class="keywordflow">case</span> -22:   <span class="keywordflow">return</span> KEY_ecirc;
<a name="l00615"></a>00615         <span class="keywordflow">case</span> -19:   <span class="keywordflow">return</span> KEY_iacute;
<a name="l00616"></a>00616         <span class="keywordflow">case</span> -20:   <span class="keywordflow">return</span> KEY_igrave;
<a name="l00617"></a>00617         <span class="keywordflow">case</span> -17:   <span class="keywordflow">return</span> KEY_iuml;
<a name="l00618"></a>00618         <span class="keywordflow">case</span> -18:   <span class="keywordflow">return</span> KEY_icirc;
<a name="l00619"></a>00619         <span class="keywordflow">case</span> -13:   <span class="keywordflow">return</span> KEY_oacute;
<a name="l00620"></a>00620         <span class="keywordflow">case</span> -14:   <span class="keywordflow">return</span> KEY_ograve;
<a name="l00621"></a>00621         <span class="keywordflow">case</span> -10:   <span class="keywordflow">return</span> KEY_ouml;
<a name="l00622"></a>00622         <span class="keywordflow">case</span> -12:   <span class="keywordflow">return</span> KEY_ocirc;
<a name="l00623"></a>00623         <span class="keywordflow">case</span> -6:    <span class="keywordflow">return</span> KEY_uacute;
<a name="l00624"></a>00624         <span class="keywordflow">case</span> -7:    <span class="keywordflow">return</span> KEY_ugrave;
<a name="l00625"></a>00625         <span class="keywordflow">case</span> -4:    <span class="keywordflow">return</span> KEY_uuml;
<a name="l00626"></a>00626         <span class="keywordflow">case</span> -5:    <span class="keywordflow">return</span> KEY_ucirc;
<a name="l00627"></a>00627         <span class="comment">// Accentuated characters copied from the output itself.</span>
<a name="l00628"></a>00628         <span class="keywordflow">case</span> -96:   <span class="keywordflow">return</span> KEY_aacute;
<a name="l00629"></a>00629         <span class="keywordflow">case</span> -123:  <span class="keywordflow">return</span> KEY_agrave;
<a name="l00630"></a>00630         <span class="keywordflow">case</span> -124:  <span class="keywordflow">return</span> KEY_auml;
<a name="l00631"></a>00631         <span class="keywordflow">case</span> -125:  <span class="keywordflow">return</span> KEY_acirc;
<a name="l00632"></a>00632         <span class="keywordflow">case</span> -121:  <span class="keywordflow">return</span> KEY_ccedil;
<a name="l00633"></a>00633         <span class="keywordflow">case</span> -126:  <span class="keywordflow">return</span> KEY_eacute;
<a name="l00634"></a>00634         <span class="keywordflow">case</span> -118:  <span class="keywordflow">return</span> KEY_egrave;
<a name="l00635"></a>00635         <span class="keywordflow">case</span> -119:  <span class="keywordflow">return</span> KEY_euml;
<a name="l00636"></a>00636         <span class="keywordflow">case</span> -120:  <span class="keywordflow">return</span> KEY_ecirc;
<a name="l00637"></a>00637         <span class="keywordflow">case</span> -95:   <span class="keywordflow">return</span> KEY_iacute;
<a name="l00638"></a>00638         <span class="keywordflow">case</span> -115:  <span class="keywordflow">return</span> KEY_igrave;
<a name="l00639"></a>00639         <span class="keywordflow">case</span> -117:  <span class="keywordflow">return</span> KEY_iuml;
<a name="l00640"></a>00640         <span class="keywordflow">case</span> -116:  <span class="keywordflow">return</span> KEY_icirc;
<a name="l00641"></a>00641         <span class="keywordflow">case</span> -94:   <span class="keywordflow">return</span> KEY_oacute;
<a name="l00642"></a>00642         <span class="keywordflow">case</span> -107:  <span class="keywordflow">return</span> KEY_ograve;
<a name="l00643"></a>00643         <span class="keywordflow">case</span> -108:  <span class="keywordflow">return</span> KEY_ouml;
<a name="l00644"></a>00644         <span class="keywordflow">case</span> -109:  <span class="keywordflow">return</span> KEY_ocirc;
<a name="l00645"></a>00645         <span class="comment">//case -93:   return KEY_uacute;    // Conflicts with POUND!</span>
<a name="l00646"></a>00646         <span class="keywordflow">case</span> -105:  <span class="keywordflow">return</span> KEY_ugrave;
<a name="l00647"></a>00647         <span class="keywordflow">case</span> -127:  <span class="keywordflow">return</span> KEY_uuml;
<a name="l00648"></a>00648         <span class="keywordflow">case</span> -106:  <span class="keywordflow">return</span> KEY_ucirc;
<a name="l00649"></a>00649 
<a name="l00650"></a>00650         <span class="comment">// Special characters.</span>
<a name="l00651"></a>00651         <span class="keywordflow">case</span> -75:   <span class="keywordflow">return</span> MICRO;
<a name="l00652"></a>00652         <span class="keywordflow">case</span> -26:   <span class="keywordflow">return</span> MICRO;       <span class="comment">// Copied from the output itself.</span>
<a name="l00653"></a>00653         <span class="keywordflow">case</span> -78:   <span class="keywordflow">return</span> SQUARE;
<a name="l00654"></a>00654         <span class="keywordflow">case</span> -3:    <span class="keywordflow">return</span> SQUARE;      <span class="comment">// Copied from the output itself.</span>
<a name="l00655"></a>00655         <span class="keywordflow">case</span> -80:   <span class="keywordflow">return</span> DEGREE;
<a name="l00656"></a>00656         <span class="keywordflow">case</span> -8:    <span class="keywordflow">return</span> DEGREE;      <span class="comment">// Copied from the output itself.</span>
<a name="l00657"></a>00657         <span class="keywordflow">case</span> -87:   <span class="keywordflow">return</span> COPYRIGHT;
<a name="l00658"></a>00658         <span class="keywordflow">case</span> -72:   <span class="keywordflow">return</span> COPYRIGHT;   <span class="comment">// Copied from the output itself.</span>
<a name="l00659"></a>00659         <span class="keywordflow">case</span> -89:   <span class="keywordflow">return</span> PARAGRAPH;
<a name="l00660"></a>00660         <span class="keywordflow">case</span> -11:   <span class="keywordflow">return</span> PARAGRAPH;   <span class="comment">// Copied from the output itself.</span>
<a name="l00661"></a>00661         <span class="keywordflow">case</span> -93:   <span class="keywordflow">return</span> POUND;
<a name="l00662"></a>00662         <span class="keywordflow">case</span> -100:  <span class="keywordflow">return</span> POUND;       <span class="comment">// Copied from the output itself.</span>
<a name="l00663"></a>00663         <span class="keywordflow">case</span> -128:  <span class="keywordflow">return</span> EURO;
<a name="l00664"></a>00664         <span class="keywordflow">case</span> -79:   <span class="keywordflow">return</span> EURO;    <span class="comment">// Copied from the output itself.</span>
<a name="l00665"></a>00665         }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667         <span class="comment">// Unhandled</span>
<a name="l00668"></a>00668         <span class="comment">// Use default behaviour.</span>
<a name="l00669"></a>00669         <span class="keyword">const</span> <a class="code" href="io__device_8h.html#a90d295cf6b6bc9873c186cc8851147f8" title="Input characters.">KEY</a> e_Char = <a class="code" href="classTelnetConnection.html#ae3858fcf54afc30be3a18370b0623eac" title="Character input handler.">IODevice::GetKey</a>(i_Front);
<a name="l00670"></a>00670         <span class="keywordflow">if</span> (e_Char != <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ae42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>)
<a name="l00671"></a>00671         {
<a name="l00672"></a>00672             <span class="keywordflow">return</span> e_Char;
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674         <span class="keywordflow">else</span>
<a name="l00675"></a>00675         {
<a name="l00676"></a>00676             <span class="comment">// Unknown character.</span>
<a name="l00677"></a>00677             <span class="keywordflow">return</span> <a class="code" href="classTelnetConnection.html#ae3858fcf54afc30be3a18370b0623eac" title="Character input handler.">GetKey</a>();
<a name="l00678"></a>00678         }
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681     <span class="keywordflow">return</span> <a class="code" href="io__device_8h.html#a87c1c1677bb8199c62a3de0ebc270471ae42682039e1a584113718465a202d0c0" title="Null key.">NULL_KEY</a>;
<a name="l00682"></a>00682 }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 <span class="keywordtype">void</span> <a class="code" href="classTelnetConnection.html#abd3418d5f2a6d620406616e1aa5c7f1f" title="Output handler.">TelnetConnection::PutString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> STR_Out)<span class="keyword"> const</span>
<a name="l00685"></a>00685 <span class="keyword"></span>{
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (STR_Out != NULL)
<a name="l00687"></a>00687     {
<a name="l00688"></a>00688         <span class="keyword">const</span> <span class="keywordtype">int</span> i_InLen = (int) strlen(STR_Out);
<a name="l00689"></a>00689         <span class="keywordtype">int</span> i_OutLen = i_InLen;
<a name="l00690"></a>00690         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;i_InLen; i++) {
<a name="l00691"></a>00691             <span class="keywordflow">if</span> (STR_Out[i] == <span class="charliteral">&#39;\n&#39;</span>) {
<a name="l00692"></a>00692                 i_OutLen ++;
<a name="l00693"></a>00693             }
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695         <span class="keywordflow">if</span> (i_OutLen &gt; 0)
<a name="l00696"></a>00696         <span class="keywordflow">if</span> (<span class="keywordtype">char</span>* <span class="keyword">const</span> str_Out = <span class="keyword">new</span> <span class="keywordtype">char</span>[i_OutLen + 1])
<a name="l00697"></a>00697         {
<a name="l00698"></a>00698             memset(str_Out, <span class="charliteral">&#39;\0&#39;</span>, i_OutLen + 1);
<a name="l00699"></a>00699 
<a name="l00700"></a>00700             <span class="comment">// Conversions.</span>
<a name="l00701"></a>00701             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0, o=0; i&lt;i_InLen; i++)
<a name="l00702"></a>00702             {
<a name="l00703"></a>00703                 <span class="keywordflow">switch</span> (STR_Out[i])
<a name="l00704"></a>00704                 {
<a name="l00705"></a>00705                 <span class="keywordflow">case</span> KEY_aacute:    str_Out[o++] = (char) -96;  <span class="keywordflow">break</span>;
<a name="l00706"></a>00706                 <span class="keywordflow">case</span> KEY_agrave:    str_Out[o++] = (char) -123; <span class="keywordflow">break</span>;
<a name="l00707"></a>00707                 <span class="keywordflow">case</span> KEY_auml:      str_Out[o++] = (char) -124; <span class="keywordflow">break</span>;
<a name="l00708"></a>00708                 <span class="keywordflow">case</span> KEY_acirc:     str_Out[o++] = (char) -125; <span class="keywordflow">break</span>;
<a name="l00709"></a>00709                 <span class="keywordflow">case</span> KEY_ccedil:    str_Out[o++] = (char) -121; <span class="keywordflow">break</span>;
<a name="l00710"></a>00710                 <span class="keywordflow">case</span> KEY_eacute:    str_Out[o++] = (char) -126; <span class="keywordflow">break</span>;
<a name="l00711"></a>00711                 <span class="keywordflow">case</span> KEY_egrave:    str_Out[o++] = (char) -118; <span class="keywordflow">break</span>;
<a name="l00712"></a>00712                 <span class="keywordflow">case</span> KEY_euml:      str_Out[o++] = (char) -119; <span class="keywordflow">break</span>;
<a name="l00713"></a>00713                 <span class="keywordflow">case</span> KEY_ecirc:     str_Out[o++] = (char) -120; <span class="keywordflow">break</span>;
<a name="l00714"></a>00714                 <span class="keywordflow">case</span> KEY_iacute:    str_Out[o++] = (char) -95;  <span class="keywordflow">break</span>;
<a name="l00715"></a>00715                 <span class="keywordflow">case</span> KEY_igrave:    str_Out[o++] = (char) -115; <span class="keywordflow">break</span>;
<a name="l00716"></a>00716                 <span class="keywordflow">case</span> KEY_iuml:      str_Out[o++] = (char) -117; <span class="keywordflow">break</span>;
<a name="l00717"></a>00717                 <span class="keywordflow">case</span> KEY_icirc:     str_Out[o++] = (char) -116; <span class="keywordflow">break</span>;
<a name="l00718"></a>00718                 <span class="keywordflow">case</span> KEY_oacute:    str_Out[o++] = (char) -94;  <span class="keywordflow">break</span>;
<a name="l00719"></a>00719                 <span class="keywordflow">case</span> KEY_ograve:    str_Out[o++] = (char) -107; <span class="keywordflow">break</span>;
<a name="l00720"></a>00720                 <span class="keywordflow">case</span> KEY_ouml:      str_Out[o++] = (char) -108; <span class="keywordflow">break</span>;
<a name="l00721"></a>00721                 <span class="keywordflow">case</span> KEY_ocirc:     str_Out[o++] = (char) -109; <span class="keywordflow">break</span>;
<a name="l00722"></a>00722                 <span class="keywordflow">case</span> KEY_uacute:    str_Out[o++] = (char) -93;  <span class="keywordflow">break</span>;
<a name="l00723"></a>00723                 <span class="keywordflow">case</span> KEY_ugrave:    str_Out[o++] = (char) -105; <span class="keywordflow">break</span>;
<a name="l00724"></a>00724                 <span class="keywordflow">case</span> KEY_uuml:      str_Out[o++] = (char) -127; <span class="keywordflow">break</span>;
<a name="l00725"></a>00725                 <span class="keywordflow">case</span> KEY_ucirc:     str_Out[o++] = (char) -106; <span class="keywordflow">break</span>;
<a name="l00726"></a>00726                 <span class="keywordflow">case</span> SQUARE:        str_Out[o++] = (char) -3;   <span class="keywordflow">break</span>;
<a name="l00727"></a>00727                 <span class="keywordflow">case</span> EURO:          str_Out[o++] = (char) -79;  <span class="keywordflow">break</span>;
<a name="l00728"></a>00728                 <span class="keywordflow">case</span> POUND:         str_Out[o++] = (char) -100; <span class="keywordflow">break</span>;
<a name="l00729"></a>00729                 <span class="keywordflow">case</span> MICRO:         str_Out[o++] = (char) -26;  <span class="keywordflow">break</span>;
<a name="l00730"></a>00730                 <span class="keywordflow">case</span> PARAGRAPH:     str_Out[o++] = (char) -11;  <span class="keywordflow">break</span>;
<a name="l00731"></a>00731                 <span class="keywordflow">case</span> DEGREE:        str_Out[o++] = (char) -8;   <span class="keywordflow">break</span>;
<a name="l00732"></a>00732                 <span class="keywordflow">case</span> COPYRIGHT:     str_Out[o++] = (char) -72;  <span class="keywordflow">break</span>;
<a name="l00733"></a>00733                 <span class="keywordflow">case</span> <span class="charliteral">&#39;\n&#39;</span>:          str_Out[o++] = <span class="charliteral">&#39;\r&#39;</span>; str_Out[o++] = <span class="charliteral">&#39;\n&#39;</span>; <span class="keywordflow">break</span>;
<a name="l00734"></a>00734                 <span class="keywordflow">default</span>:            str_Out[o++] = STR_Out[i];  <span class="keywordflow">break</span>;
<a name="l00735"></a>00735                 }
<a name="l00736"></a>00736             }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738             <span class="comment">// Send the buffer.</span>
<a name="l00739"></a>00739             <span class="keywordflow">if</span> (<a class="code" href="classOutputDevice.html" title="Generic output device.">OutputDevice</a>* <span class="keyword">const</span> pcli_TraceStream = &amp; const_cast&lt;OutputDevice&amp;&gt;(<a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a51de9b3da8481cb2c65b8794c144900b" title="Stream access.">GetStream</a>()))
<a name="l00740"></a>00740             {
<a name="l00741"></a>00741                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r=0; r&lt;i_OutLen; r++)
<a name="l00742"></a>00742                 {
<a name="l00743"></a>00743                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT) &lt;&lt; <span class="stringliteral">&quot;sending &quot;</span> &lt;&lt; (char) str_Out[r] &lt;&lt; endl;
<a name="l00744"></a>00744                 }
<a name="l00745"></a>00745                 <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a111bcade621537d1e5b960a4c1331223" title="Stream positionning.">SetStream</a>(*pcli_TraceStream);
<a name="l00746"></a>00746             }
<a name="l00747"></a>00747             <span class="keyword">const</span> <span class="keywordtype">int</span> i_Len = send(m_iSocket, str_Out, i_OutLen, 0);
<a name="l00748"></a>00748             <span class="keywordflow">if</span> (i_Len != i_OutLen)
<a name="l00749"></a>00749             {
<a name="l00750"></a>00750                 <span class="comment">// Something has failed regarding output</span>
<a name="l00751"></a>00751                 <span class="comment">// Check whether the trace stream is not this output stream.</span>
<a name="l00752"></a>00752                 <span class="comment">// If it is, change to stderr in order to avoid infinite loops.</span>
<a name="l00753"></a>00753                 <span class="keywordflow">if</span> (&amp; <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().GetStream().<a class="code" href="classOutputDevice.html#a1f5dca5e858cd8f99bf43a0671faac60" title="Actual device handler.">GetActualDevice</a>() == <span class="keyword">this</span>)
<a name="l00754"></a>00754                 {
<a name="l00755"></a>00755                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a111bcade621537d1e5b960a4c1331223" title="Stream positionning.">SetStream</a>(<a class="code" href="classOutputDevice.html#a3f1e2af2786d5f17e295ce0718d901cf" title="Standard error device.">GetStdErr</a>());
<a name="l00756"></a>00756                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT) &lt;&lt; <span class="stringliteral">&quot;Trace stream changed to stderr&quot;</span> &lt;&lt; endl;
<a name="l00757"></a>00757                 }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759                 <a class="code" href="classOutputDevice.html#ac831dff60351f1a3dffd667e175e8f23" title="Last error.">m_cliLastError</a>
<a name="l00760"></a>00760                     .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3af12fbeaebaa487c3970ecc2cf837e0df" title="English.">ResourceString::LANG_EN</a>, <span class="stringliteral">&quot;Telnet emission error&quot;</span>)
<a name="l00761"></a>00761                     .<a class="code" href="classResourceString.html#a7a475c727ce2d3b13a4ce609032a0a8a" title="Adds resource for a given language.">SetString</a>(<a class="code" href="classResourceString.html#a88d585d899c8482aeb434571923739b3a142a22fb5f61fe5c723693b4cc887f4f" title="French.">ResourceString::LANG_FR</a>, <span class="stringliteral">&quot;Echec d&#39;émission en telnet&quot;</span>);
<a name="l00762"></a>00762 
<a name="l00763"></a>00763                 <span class="keywordflow">if</span> (i_Len &lt; 0)
<a name="l00764"></a>00764                 {
<a name="l00765"></a>00765                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT) &lt;&lt; <span class="stringliteral">&quot;send failed&quot;</span> &lt;&lt; endl;
<a name="l00766"></a>00766                 }
<a name="l00767"></a>00767                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_Len &lt; i_OutLen)
<a name="l00768"></a>00768                 {
<a name="l00769"></a>00769                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT)
<a name="l00770"></a>00770                         &lt;&lt; <span class="stringliteral">&quot;send incomplete&quot;</span>
<a name="l00771"></a>00771                         &lt;&lt; <span class="stringliteral">&quot; (only &quot;</span> &lt;&lt; i_Len &lt;&lt; <span class="stringliteral">&quot; characters sent&quot;</span>
<a name="l00772"></a>00772                         &lt;&lt; <span class="stringliteral">&quot; over &quot;</span> &lt;&lt; i_OutLen &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l00773"></a>00773                 }
<a name="l00774"></a>00774                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i_Len &gt; i_OutLen)
<a name="l00775"></a>00775                 {
<a name="l00776"></a>00776                     <a class="code" href="traces_8h.html#a757ce8f9014dd17ed7349efcdd702af9" title="Singleton.">GetTraces</a>().<a class="code" href="classTraces.html#a69bc0bc6fcd2a39cb61304e6b92506c2" title="Trace routine.">Trace</a>(CLI_TELNET_OUT)
<a name="l00777"></a>00777                         &lt;&lt; <span class="stringliteral">&quot;strange send return value&quot;</span>
<a name="l00778"></a>00778                         &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; i_Len &lt;&lt; <span class="stringliteral">&quot; for &quot;</span> &lt;&lt; i_OutLen &lt;&lt; <span class="stringliteral">&quot; characters sent)&quot;</span> &lt;&lt; endl;
<a name="l00779"></a>00779                 }
<a name="l00780"></a>00780             }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782             <span class="comment">// Free the local output buffer.</span>
<a name="l00783"></a>00783             <span class="keyword">delete</span> [] str_Out;
<a name="l00784"></a>00784         }
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="keywordtype">void</span> <a class="code" href="classTelnetConnection.html#a7fa4b5dbc540af6113fb297bee75e6d1" title="Beep handler.">TelnetConnection::Beep</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00789"></a>00789 <span class="keyword"></span>{
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Dec 29 2010 04:19:01 for CLI by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
